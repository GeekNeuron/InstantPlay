:root {
    --font-main: 'Clear Sans', 'Helvetica Neue', Arial, sans-serif; /* From your example */
    --border-radius-small: 6px; /* Adjusted based on your --border-radius / 1.5 or similar */
    --border-radius-medium: 10px; /* Your --border-radius */
    --border-radius-large: 15px; /* Adjusted */
    --transition-speed: 0.25s; /* Kept our transition speed */
    --gap-size: 10px; /* From your example, can be used for flex gaps */

    /* Page wrapper max-width, kept from our design */
    --page-wrapper-max-width: 550px;
    --grid-size-js: 15px; 
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

html { 
    box-sizing: border-box; 
    -webkit-tap-highlight-color: transparent; 
}
*, *:before, *:after { 
    box-sizing: inherit; 
}

body {
    font-family: var(--font-main);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    min-height: 100vh;
    background-color: var(--bg-color); /* General name, defined in theme files */
    color: var(--text-color-primary);  /* General name, defined in theme files */
    transition: background-color var(--transition-speed) ease, color var(--transition-speed) ease;
    padding: 15px; /* From your example body style */
    /* padding-top: 60px; // This was in your example, but our header is part of flow */
    text-align: center;
    line-height: 1.6;
    overflow: hidden; /* From your example body style */
}

.page-wrapper {
    width: 100%;
    max-width: var(--page-wrapper-max-width);
    display: flex;
    flex-direction: column;
    align-items: center;
    padding-bottom: 20px;
}

/* Settings Box (Header) - Main container for controls and game */
.settings-box {
    width: 100%;
    padding: 20px; /* From your .container style */
    margin-bottom: 15px;
    display: flex;
    flex-direction: column;
    align-items: center;
    background-color: var(--container-bg); /* From theme */
    border-radius: var(--border-radius-medium); /* Updated border-radius */
    border: 1px solid var(--border-color);    /* From theme */
    box-shadow: 0 6px 18px rgba(0, 0, 0, 0.08); /* From your .container style */
    transition: background-color var(--transition-speed) ease;
}

h1.game-title-header {
    font-size: 2.8em; /* Adjusted from your h1, can be tuned */
    font-weight: bold;
    color: var(--header-text-color); /* From theme */
    margin: 0 0 20px 0; /* Adjusted margin */
    padding: 5px;
    background-color: transparent !important;
    border: none !important;
    cursor: pointer;
    user-select: none;
    text-align: center;
    width: 100%;
}

.controls-panel {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 100%;
    gap: var(--gap-size); /* Use gap-size from theme */
    margin-bottom: 20px; /* From your header style */
    flex-wrap: wrap;
}

.scores-group-left {
    display: flex;
    align-items: center;
    gap: var(--gap-size); /* Use gap-size */
    flex-shrink: 0; 
}

.score-box { /* Adopted from your .score-box */
    background-color: var(--score-box-bg);
    color: var(--score-box-text);
    padding: 8px 15px; /* Adjusted padding */
    border-radius: calc(var(--border-radius-medium) - 4px); /* From your example */
    font-size: 1em; /* From your example */
    font-weight: bold;
    text-align: center;
    min-width: 90px; /* Adjusted based on content */
    transition: background-color var(--transition-speed) ease, color var(--transition-speed) ease;
}

.settings-selectors-right {
    display: flex;
    align-items: center;
    gap: var(--gap-size);
    flex-wrap: nowrap;
}

.control-group {
    display: flex;
    align-items: center;
}

.control-group select { /* Style for difficulty and mode selects */
    padding: 8px 10px; /* Similar to score-box padding */
    border-radius: calc(var(--border-radius-medium) - 4px);
    border: 1px solid var(--border-color);
    background-color: var(--grid-cell-bg); /* Using grid-cell-bg for select background */
    color: var(--text-color-primary);
    font-family: var(--font-main);
    font-size: 0.9em; /* Slightly smaller than score-box text */
    cursor: pointer;
    min-width: 100px;
    text-align: center;
    text-align-last: center;
    -moz-text-align-last: center;
    transition: background-color var(--transition-speed) ease, border-color var(--transition-speed) ease;
}

.control-group select:focus {
    outline: none;
    border-color: var(--accent-color); /* Use accent color defined in themes */
    box-shadow: 0 0 0 2px var(--accent-color-translucent, rgba(0, 123, 255, 0.25));
}

.game-container {
    padding: 0;
    border: none;
    box-shadow: none;
    background-color: transparent;
    display: flex;
    flex-direction: column;
    width: 100%;
    max-width: 100%;
}

.game-header-combo { /* Header for combo, above canvas */
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 8px 10px;
    margin-bottom: var(--gap-size); /* Use gap-size */
    font-size: 1rem;
    color: var(--accent-color); /* Accent color for combo */
    min-height: 30px; /* Ensure some height */
    background-color: var(--grid-cell-bg); /* Use grid-cell-bg for a distinct but integrated look */
    border-radius: var(--border-radius-small) var(--border-radius-small) 0 0; /* Match canvas rounding */
}

#combo-display { /* ... */ }

#gameCanvas {
    display: block;
    width: 100%; 
    aspect-ratio: 1 / 1; /* Assuming square canvas based on ROWS/COLS being equal */
    /* max-height: calc(var(--grid-side-length-desktop) * 0.9); From your 2048 example, adjusted */
    max-height: 400px; /* Or a fixed max for better control, aligns with your 2048 canvas size */
    background-color: var(--grid-bg); /* From your example (grid-bg for canvas background) */
    border-radius: 0 0 var(--border-radius-small) var(--border-radius-small); /* Match combo header rounding */
    border: 2px solid var(--border-color); /* Subtle border */
    box-shadow: 0 4px 8px rgba(0,0,0,0.1); /* Softer shadow */
    transition: background-color var(--transition-speed) ease, border-color var(--transition-speed) ease;
}

/* Game Legend Styling */
.game-legend {
    width: 100%;
    margin-top: var(--gap-size);
    padding: var(--gap-size);
    /* background-color: var(--container-bg); // Or transparent to use settings-box bg */
    border-top: 1px solid var(--border-color);
    border-radius: 0 0 var(--border-radius-medium) var(--border-radius-medium); /* If it's the last visual element */
    text-align: center;
}
.legend-title { /* ... (as before, or remove if not used) ... */ }
.legend-items-container { /* ... (as before) ... */ }
.legend-item { /* ... (as before) ... */ }
.legend-item:hover, .legend-item:focus { background-color: var(--grid-cell-bg); outline: none; } /* Use grid-cell-bg for hover */
.legend-item-icon { /* ... (as before, uses --grid-size-js and --border-color) ... */ }
.legend-item-name { /* ... (as before, uses --text-color-muted) ... */ }

/* Legend Info Bubble */
.legend-info-bubble {
    background-color: var(--modal-content-bg); /* Use modal content bg for bubble */
    color: var(--modal-text-color);       /* Use modal text color */
    border: 1px solid var(--border-color);
    /* ... (rest of bubble styles as before) ... */
}
.legend-info-bubble .bubble-title { color: var(--accent-color); /* ... */ }
.legend-info-bubble .bubble-arrow { /* ... (Ensure arrow color uses bubble background) ... */ }


footer {
    width: 100%;
    margin-top: 20px;
    padding-top: 10px;
    border-top: 1px solid var(--border-color);
    font-size: 0.85em; /* From your footer style */
    color: var(--text-color-primary); /* From your footer style */
    opacity: 0.8; /* Adjusted opacity */
    text-align: center;
    transition: color var(--transition-speed) ease;
}

/* Achievement Notification & Modal (styles remain largely the same, will use new theme colors) */
.achievement-popup { background-color: var(--accent-color); color: var(--button-text); /* ... */ }
/* ... (other achievement styles) ... */
.modal { background-color: var(--modal-bg); /* ... */ }
.modal-content { background-color: var(--modal-content-bg); color: var(--modal-text-color); /* ... */ }
.modal button { background-color: var(--button-bg); color: var(--button-text); /* ... */ }
.modal button:hover { background-color: var(--button-hover-bg); /* ... */ }


/* Responsive adjustments - adapting from your example where applicable */
@media (max-width: 520px) { /* General breakpoint from your example */
    body { padding: 10px; /* padding-top: 50px; // Removed fixed top padding */ }
    .settings-box { padding: 15px; } /* Adjust padding for settings box */
    h1.game-title-header { font-size: 2.2em; margin-bottom: 15px; } /* From your h1 */
    
    .controls-panel {
        flex-direction: column;
        align-items: stretch;
        gap: 12px;
        margin-bottom: 15px;
    }
    .scores-group-left, .settings-selectors-right {
        justify-content: space-around;
        width: 100%;
        gap: 8px; /* Gap within stacked groups */
    }
    .score-box { font-size: 0.9em; padding: 6px 10px; min-width: 80px; } /* From your score-box */
    .control-group { flex-grow: 1; display: flex; justify-content: center; }
    .control-group select { width: 100%; max-width: 180px; font-size: 0.9em; }

    #gameCanvas {
        /* From your .grid-container responsive */
        width: 90vw; 
        height: 90vw; /* If using aspect-ratio, this height is not needed */
        max-width: 360px; /* Cap size on mobile */
        max-height: 360px;
        /* padding: calc(var(--gap-size) * 0.8); // Canvas doesn't have padding */
    }
    .game-legend { margin-top: 15px; }
    footer { font-size: 0.8em; margin-top: 15px; }
}

@media (max-width: 380px) {
    h1.game-title-header { font-size: 1.9em; }
    .score-box { font-size: 0.8em; padding: 5px 7px; min-width: 70px; }
    .control-group select { font-size: 0.8em; }
    #gameCanvas {
        width: 85vw; 
        height: 85vw; /* If using aspect-ratio, this height is not needed */
        max-width: 300px;
        max-height: 300px;
    }
}
